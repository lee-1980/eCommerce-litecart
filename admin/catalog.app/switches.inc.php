<?phpdocument::$snippets['head_tags']['chosen'] = '<link rel="stylesheet" href="'. WS_DIR_APP .'ext/chosen/chosen.css" />';// document::$snippets['head_tags']['ImageSelect'] = '<link rel="stylesheet" href="'. WS_DIR_APP .'ext/chosen/ImageSelect.css" />';document::$snippets['foot_tags']['chosen'] = '<script src="'. WS_DIR_APP .'ext/chosen/chosen.jquery.js"></script>';// document::$snippets['foot_tags']['ImageSelect'] = '<script src="'. WS_DIR_APP .'ext/chosen/ImageSelect.jquery.js"></script>';breadcrumbs::add(language::translate('title_switches', 'Switches'));// if(empty($_POST)){//     $keylist = ['default_price_prices', 'guest_price_prices', 'wholesale_price_prices', 'insane_price_prices'];//     foreach ($keylist as $key){//         $settings_query = database::query(//             "select * from " . DB_TABLE_SETTINGS . "//           where `key` = '" . database::input($key) . "';"//         );//         if($setting = database::fetch($settings_query)){//             $_POST['master'][$key] = $setting['value'];//         }//     }// }$i =0;if(isset($_POST['save'])) {    $_POST['master']['insane_price_prices'] = isset($_POST['master']['insane_price_prices']) ? $_POST['master']['insane_price_prices'] : array();    // $_POST['master']['guest_price_prices'] = isset($_POST['master']['guest_price_prices']) ? 1 : 0;    // $_POST['master']['default_price_prices'] = isset($_POST['master']['default_price_prices']) ? 1 : 0;    // $_POST['master']['wholesale_price_prices'] = isset($_POST['master']['wholesale_price_prices']) ? 1 : 0;    // $_POST['master']['insane_price_prices'] = isset($_POST['master']['insane_price_prices']) ? 1 : 0;    // $_POST['master']['specialprice'] = isset($_POST['master']['specialprice']) ? 1 : 0;    // $_POST['master']['customer_specialprice'] = isset($_POST['master']['customer_specialprice']) ? 1 : 0;     // $_POST['master']['wholesale_specialprice'] = isset($_POST['master']['wholesale_specialprice']) ? 1 : 0;    // $_POST['master']['sign_in_deal'] = isset($_POST['master']['sign_in_deal']) ? 1 : 0;    // $_POST['master']['sign_in'] = isset($_POST['master']['sign_in']) ? 1 : 0;    // $_POST['master']['insaneprice'] = isset($_POST['master']['insaneprice']) ? 1 : 0;    try{                $query = "select id from " . DB_TABLE_PRODUCTS;        $products_query = database::query($query);        $updateQuery = "";        while ($product = database::fetch($products_query)) {            if ($updateQuery != '') {                $updateQuery .= ",";            }            $updateQuery .= "(" . $product['id'] . "," . (in_array ( $product['id'], $_POST['master']['insane_price_prices'])? 1 : 0). ")";        }        database::query(            "insert into " . DB_TABLE_PRODUCTS . "            (id, master_insane_deal_price)            values ". $updateQuery ." on duplicate key update master_insane_deal_price=values(master_insane_deal_price);"        );    //     $products_query = database::query(    //         "select id, date_updated from ". DB_TABLE_PRODUCTS ."    // where status    // order by id;"    //     );    //     $updateQuery = "";    //     while ($product = database::fetch($products_query)) {    //         if($updateQuery != ''){    //             $updateQuery .= ",";    //         }    //         $updateQuery.= "(". $product['id'] .",     //         ".$_POST['master']['sign_in'].",     //         ".$_POST['master']['sign_in_deal'].",     //         ".$_POST['master']['default_price_prices'].",     //         ".$_POST['master']['guest_price_prices'].",    //         ".$_POST['master']['wholesale_price_prices'].",    //         ".$_POST['master']['insane_price_prices'].")";    //     }    //     database::query(    //         "insert into " . DB_TABLE_PRODUCTS . "    //         (id,     //         sign_in,     //         sign_in_deal,     //         master_customer_special_price,     //         master_guest_special_price,     //         master_wholesale_special_price,     //         master_insane_deal_price)    //         values ". $updateQuery ." on duplicate key update     //         sign_in = values(sign_in),     //         sign_in_deal = values(sign_in_deal),     //         master_customer_special_price = values(master_customer_special_price),     //         master_guest_special_price = values(master_guest_special_price),     //         master_wholesale_special_price = values(master_wholesale_special_price),     //         master_insane_deal_price = values(master_insane_deal_price);"    //     );    //     foreach (array_keys($_POST['master']) as $key) {    //         $settings_query = database::query(    //             "select * from " . DB_TABLE_SETTINGS . "    //       where `key` = '" . database::input($key) . "';"    //         );    //         if (!$setting = database::fetch($settings_query)) {    //             database::query(    //                 "insert into " . DB_TABLE_SETTINGS . "    //         (`key`, `value`)    //         values ('" . $key . "', '" . $_POST['master'][$key] . "');"    //             );    //         } else {    //             database::query(    //                 "update " . DB_TABLE_SETTINGS . "    //       set    //         `value` = '" . database::input($_POST['master'][$key]) . "',    //         date_updated = '" . date('Y-m-d H:i:s') . "'    //       where `key` = '" . database::input($key) . "'    //       limit 1;"    //             );    //         }    //     }    }    catch (Exception $e){        throw new Exception(language::translate('Updating failed!'));    }}$products_query = functions::catalog_products_query();?><?php echo functions::form_draw_form_begin('switch_master', 'post', false, true); ?><div class="panel panel-app">    <div class="panel-heading">        <?php echo $app_icon; ?> Switches    </div>        <input type="hidden" name="master_price_setting" value="">  <h2><?php echo language::translate('title_guest_price_prices', 'Guest Price Prices'); ?></h2>    <div class="form-group">        <div class="checkbox">            <label><?php echo functions::form_draw_checkbox('master[sign_in]', '1', true); ?> <?php echo language::translate('title_sign_in', 'Sign In'); ?></label>        </div>               <div class="checkbox">            <label><?php echo functions::form_draw_checkbox('master[guest_price_prices]', '1', true); ?> <?php echo language::translate('title_master_guest_special_price', 'Master Guest Special Price'); ?></label>        </div>    </div>      <h2><?php echo language::translate('title_default_price_prices', 'Default Price Prices'); ?></h2>    <div class="form-group">        <div class="checkbox">            <label><?php echo functions::form_draw_checkbox('master[default_price_prices]', '1', true); ?> <?php echo language::translate('title_master_customer_special_price', 'Master Customer Special Price'); ?></label>        </div>    </div>   <h2><?php echo language::translate('title_wholesale_price_prices', 'Wholesale Price Prices'); ?></h2>    <div class="form-group">        <div class="checkbox">            <label><?php echo functions::form_draw_checkbox('master[wholesale_price_prices]', '1', true); ?> <?php echo language::translate('title_master_wholesale_special_price', 'Master Wholesale Special Price'); ?></label>        </div>    <h2><?php echo language::translate('title_campaigns', 'Campaigns'); ?></h2>    <div class="form-group">       <div class="checkbox">            <label for="master[insane_price_prices][]">Disabled Master Insane Price Prices</label>            <select  name="master[insane_price_prices][]" class="chzn-select" multiple="multiple">                <?PHP while ($product = database::fetch($products_query)) { $i++; ?></br>                <option data-img-src="<?PHP echo ltrim($product['image'] ? '..'.WS_DIR_IMAGES.$product['image'] : '', '/'); ?>"                        value="<?PHP echo $product['id'];?>" <?PHP echo isset($product['master_insane_deal_price'])&&!empty($product['master_insane_deal_price'])?"selected": "" ?>>                    <?PHP echo $product['name'];?>                </option>                <?PHP }?>            </select>        </div>        <div class="checkbox">            <label><?php echo functions::form_draw_checkbox('master[sign_in_deal]', '1', true); ?> <?php echo language::translate('title_sign_in_deal', 'Sign In Deal'); ?></label>        </div>      </div><div class="panel-action btn-group">    <?php echo functions::form_draw_button('save', language::translate('title_save', 'Save'), 'submit', '', 'save'); ?></div><?php echo functions::form_draw_form_end(); ?><script type="text/javascript">    $('.chzn-select').chosen({width:"100%", placeholder_text: "Select Options"});</script>