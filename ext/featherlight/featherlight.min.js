(function($){'use strict';if('undefined'===typeof $){if('console'in window){window.console.error('Featherlight requires jQuery.');}
return;}
if($.fn.jquery.match(/-ajax/)){if('console'in window){window.console.info('Featherlight needs regular jQuery, not the slim version.');}
return;}
function Featherlight($content,config){if(this instanceof Featherlight){this.id=Featherlight.id++;this.setup($content,config);this.chainCallbacks(Featherlight._callbackChain);}else{var fl=new Featherlight($content,config);fl.open();return fl;}}
var opened=[],pruneOpened=function(remove){opened=$.grep(opened,function(fl){return fl!==remove&&fl.$instance.closest('body').length>0;});return opened;};var eventMap={keyup:'onKeyUp',resize:'onResize'};var globalEventHandler=function(event){$.each(Featherlight.opened().reverse(),function(){if(!event.isDefaultPrevented()){if(false===this[eventMap[event.type]](event)){event.preventDefault();event.stopPropagation();return false;}}});}
var toggleGlobalEvents=function(set){if(set!==Featherlight._globalHandlerInstalled){Featherlight._globalHandlerInstalled=set;var events=$.map(eventMap,function(_,name){return name+'.'+Featherlight.prototype.namespace;}).join(' ');$(window)[set?'on':'off'](events,globalEventHandler);}};Featherlight.prototype={constructor:Featherlight,namespace:'featherlight',targetAttr:'data-target',variant:null,resetCss:false,background:null,openTrigger:'click',closeTrigger:'click',filter:null,root:'body',closeOnClick:'background',closeOnEsc:true,loading:'<div class="featherlight-loader"></div>',persist:false,otherClose:null,beforeOpen:$.noop,beforeContent:$.noop,beforeClose:$.noop,afterOpen:$.noop,afterContent:$.noop,afterClose:$.noop,onKeyUp:$.noop,onResize:$.noop,type:null,closeIcon:'&#x2716;',contentFilters:['jquery','image','html','ajax','iframe','text'],width:'',height:'',maxWidth:'',maxHeight:'',requireWindowWidth:null,setup:function(target,config){if(typeof target==='object'&&target instanceof $===false&&!config){config=target;target=undefined;}
var self=$.extend(this,config,{target:target}),css=!self.resetCss?self.namespace:self.namespace+'-reset',$background=$(self.background||['<div class="'+css+'-loading '+css+'">','<div class="'+css+'-content">','<div class="'+self.namespace+'-inner">'+self.loading+'</div>','</div>','</div>'].join('')),closeButtonSelector='.'+self.namespace+'-close'+(self.otherClose?','+self.otherClose:'');self.$instance=$background.clone().addClass(self.variant);self.$instance.on(self.closeTrigger+'.'+self.namespace,function(event){var $target=$(event.target);if(('background'===self.closeOnClick&&$target.is('.'+self.namespace))||'anywhere'===self.closeOnClick||$target.closest(closeButtonSelector).length){self.close(event);event.preventDefault();}});return this;},getContent:function(){if(this.persist!==false&&this.$content){return this.$content;}
var self=this,filters=this.constructor.contentFilters,readTargetAttr=function(name){return self.$currentTarget&&self.$currentTarget.attr(name);},targetValue=readTargetAttr(self.targetAttr),data=self.target||targetValue||'';var filter=filters[self.type];if(!filter&&data in filters){filter=filters[data];data=self.target&&targetValue;}
data=data||readTargetAttr('href')||'';if(!filter){for(var filterName in filters){if(self[filterName]){filter=filters[filterName];data=self[filterName];}}}
if(!filter){var target=data;data=null;$.each(self.contentFilters,function(){filter=filters[this];if(filter.test){data=filter.test(target);}
if(!data&&filter.regex&&target.match&&target.match(filter.regex)){data=target;}
return!data;});if(!data){if('console'in window){window.console.error('Featherlight: no content filter found '+(target?' for "'+target+'"':' (no target specified)'));}
return false;}}
return filter.process.call(self,data);},setContent:function($content){var self=this;self.$instance.removeClass(self.namespace+'-loading');self.$content=$content.show();self.$instance.find('.'+self.namespace+'-content').html(self.$content);if(self.closeIcon){self.$instance.find('.'+self.namespace+'-content').prepend('<div class="'+self.namespace+'-close-icon '+self.namespace+'-close" aria-label="Close">'+
self.closeIcon+'</div>');}
return self;},open:function(event){var self=this;if(event&&(event.ctrlKey||event.shiftKey)){return false;}
if(self.requireWindowWidth&&self.requireWindowWidth>$(window).width()){return false;}
self.$instance.hide().appendTo(self.root);if((!event||!event.isDefaultPrevented())&&self.beforeOpen(event)!==false){$('body').addClass('featherlight-open');$('.featherlight').removeClass('active');self.$instance.addClass('active');if(event){event.preventDefault();}
var $content=self.getContent();if($content){opened.push(self);toggleGlobalEvents(true);self.$instance.show();self.beforeContent(event);return $.when($content).always(function($content){self.setContent($content);if(self.width){self.$content.parent().css('width',self.width);}
if(self.height){self.$content.parent().css('height',self.height);}
if(self.maxWidth){self.$content.parent().css('max-width',self.maxWidth);}
if(self.maxHeight){self.$content.parent().css('max-height',self.maxHeight);}
self.afterContent(event);}).then(self.$instance.promise()).done(function(){self.afterOpen(event);});}}
self.$instance.detach();return $.Deferred().reject().promise();},close:function(event){var self=this,deferred=$.Deferred();if(self.beforeClose(event)===false){deferred.reject();}else{if(pruneOpened(self).length===0){toggleGlobalEvents(false);}
self.$instance.hide().detach();self.afterClose(event);deferred.resolve();$('.featherlight:not(.active)').filter(':last').addClass('active');if($('.featherlight').length===0){$('body').removeClass('featherlight-open');}}
return deferred.promise();},chainCallbacks:function(chain){for(var name in chain){this[name]=$.proxy(chain[name],this,$.proxy(this[name],this));}}};$.extend(Featherlight,{id:0,autoBind:'[data-toggle="featherlight"]',defaults:Featherlight.prototype,contentFilters:{jquery:{regex:/^[#.]\w/,test:function(elem){return elem instanceof $&&elem;},process:function(elem){return this.persist!==false?$(elem):$(elem).clone(true);}},image:{regex:/\.(apng|bmp|gif|ico|jpe?g|jp2|png|svg|tiff?|webp)(\?\S*)?$/i,process:function(url){var self=this,deferred=$.Deferred(),img=new Image(),$img=$('<img src="'+url+'" alt="" />');img.onload=function(){$img.naturalWidth=img.width;$img.naturalHeight=img.height;deferred.resolve($img);};img.onerror=function(){deferred.reject($img);};img.src=url;return deferred.promise();}},html:{regex:/^\s*<[\w!][^<]*>/,process:function(html){return $(html);}},ajax:{regex:/./,process:function(url){var self=this,deferred=$.Deferred();url=url.replace('#',' #');var $container=$('<div></div>').load(url,function(response,status){if(status!=="error"){deferred.resolve($container.contents());}
deferred.fail();});return deferred.promise();}},iframe:{process:function(url){var deferred=new $.Deferred();var $content=$('<iframe/>');$content.hide().attr('src',url).on('load',function(){deferred.resolve($content.show());}).appendTo(this.$instance.find('.'+this.namespace+'-content'));return deferred.promise();}},text:{process:function(text){return $('<div>',{text:text});}}},functionAttributes:['beforeOpen','afterOpen','beforeContent','afterContent','beforeClose','afterClose'],readElementConfig:function(element){var Klass=this,regexp=new RegExp('^data-(.*)'),config={};if(element&&element.attributes){$.each(element.attributes,function(){var match=this.name.match(regexp);if(match){var val=this.value,name=$.camelCase(match[1]);if($.inArray(name,Klass.functionAttributes)>=0){val=new Function(val);}else{try{val=JSON.parse(val);}
catch(e){}}
config[name]=val;}});}
return config;},extend:function(child,defaults){var Ctor=function(){this.constructor=child;};Ctor.prototype=this.prototype;child.prototype=new Ctor();child.__super__=this.prototype;$.extend(child,this,defaults);child.defaults=child.prototype;return child;},attach:function($source,$content,config){var Klass=this;if(typeof $content==='object'&&$content instanceof $===false&&!config){config=$content;$content=undefined;}
config=$.extend({},config);var namespace=config.namespace||Klass.defaults.namespace,tempConfig=$.extend({},Klass.defaults,Klass.readElementConfig($source[0]),config),sharedPersist;var handler=function(event){var $target=$(event.currentTarget);var elemConfig=$.extend({$source:$source,$currentTarget:$target},Klass.readElementConfig($source[0]),Klass.readElementConfig(this),config);var fl=sharedPersist||$target.data('featherlight-persisted')||new Klass($content,elemConfig);if(fl.persist==='shared'){sharedPersist=fl;}else if(fl.persist!==false){$target.data('featherlight-persisted',fl);}
if(elemConfig.$currentTarget.blur){elemConfig.$currentTarget.blur();}
fl.open(event);};$source.on(tempConfig.openTrigger+'.'+tempConfig.namespace,tempConfig.filter,handler);return handler;},current:function(){var all=this.opened();return all[all.length-1]||null;},opened:function(){var klass=this;pruneOpened();return $.grep(opened,function(fl){return fl instanceof klass;});},close:function(event){var cur=this.current();if(cur){return cur.close(event);}},_onReady:function(){var Klass=this;if(Klass.autoBind){$(Klass.autoBind).each(function(){Klass.attach($(this));});$(document).on('click',Klass.autoBind,function(evt){if(evt.isDefaultPrevented()){return;}
var handler=Klass.attach($(evt.currentTarget));handler(evt);});}},_callbackChain:{onKeyUp:function(_super,event){if(27===event.keyCode){if(this.closeOnEsc){$.featherlight.close(event);}
return false;}else{return _super(event);}},beforeOpen:function(_super,event){this._previouslyActive=document.activeElement;this._$previouslyTabbable=$('a, input, select, textarea, iframe, button, iframe, [contentEditable=true]').not('[tabindex]').not(this.$instance.find('button'));this._$previouslyWithTabIndex=$('[tabindex]').not('[tabindex="-1"]');this._previousWithTabIndices=this._$previouslyWithTabIndex.map(function(_i,elem){return $(elem).attr('tabindex');});this._$previouslyWithTabIndex.add(this._$previouslyTabbable).attr('tabindex',-1);if(document.activeElement.blur){document.activeElement.blur();}
return _super(event);},afterClose:function(_super,event){var r=_super(event);var self=this;this._$previouslyTabbable.removeAttr('tabindex');this._$previouslyWithTabIndex.each(function(i,elem){$(elem).attr('tabindex',self._previousWithTabIndices[i]);});this._previouslyActive.focus();return r;},onResize:function(_super,event){return _super(event);},afterContent:function(_super,event){var r=_super(event);this.$instance.find('[autofocus]:not([disabled])').focus();this.onResize(event);return r;}}});$.featherlight=Featherlight;$.fn.featherlight=function($content,config){Featherlight.attach(this,$content,config);return this;};$(document).ready(function(){Featherlight._onReady();});}(jQuery));